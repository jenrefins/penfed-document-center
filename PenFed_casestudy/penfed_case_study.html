<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PenFed Document Upload Case Study</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: #333;
        }

        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section {
            padding: 80px 0;
            min-height: 500px;
            display: flex;
            align-items: center;
        }

        .section:nth-child(odd) {
            background-color: #ffffff;
        }

        .section:nth-child(even) {
            background-color: #eef6fc;
        }

        .section-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            align-items: center;
            width: 100%;
        }

        .section:nth-child(even) .section-content {
            direction: rtl;
        }

        .section:nth-child(even) .text-content {
            direction: ltr;
        }

        .text-content h1 {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #1c3664;
            line-height: 1.2;
        }

        .hero-section {
            padding: 80px 0;
            min-height: 350px;
            text-align: center;
            background-color: #ffffff;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            margin-bottom: 1.5rem;
            color: #1c3664;
            line-height: 1.2;
            max-width: 900px;
            margin-left: auto;
            margin-right: auto;
        }

        .text-content h2 {
            font-size: 2rem;
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: #1c3664;
            line-height: 1.3;
        }

        .text-content h3 {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            color: #0399cd;
        }

        .text-content p {
            font-size: 1.1rem;
            margin-bottom: 1rem;
            color: #555;
            font-weight: 400;
        }

        .text-content ul {
            margin-bottom: 1.5rem;
        }

        .text-content li {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #555;
            list-style-position: inside;
        }

        .subtitle {
            font-size: 1.2rem;
            color: #7f8c8d;
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .author-info {
            font-size: 1rem;
            color: #0399cd;
            font-weight: 600;
        }

        .image-content {
            text-align: center;
        }

        .image-content img {
            max-width: 100%;
            cursor: zoom-in;
            height: auto;
            border: 1px solid #e0e0e0;
            border-radius: 12px;
            padding: 20px;
            background-color: #ffffff;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
            cursor: zoom-in;
            transition: all 0.3s ease;
        }

        .thumbnail-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            max-width: 100%;
        }

        .thumbnail-grid img {
            width: 100%;
            height: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background-color: #ffffff;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            cursor: zoom-in;
            transition: all 0.3s ease;
        }

        .thumbnail-grid img:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            border-color: #c0c0c0;
        }

        .thumbnail-grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
            max-width: 650px;
        }

        .thumbnail-grid-2 img {
            width: 100%;
            height: auto;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 15px;
            background-color: #ffffff;
            box-shadow: 0 2px 12px rgba(0, 0, 0, 0.04);
            cursor: zoom-in;
            transition: all 0.3s ease;
        }

        .thumbnail-grid-2 img:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            border-color: #c0c0c0;
        }

        @media (max-width: 768px) {
            .thumbnail-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
                max-width: 400px;
            }

            .thumbnail-grid-2 {
                grid-template-columns: 1fr;
                gap: 15px;
                max-width: 400px;
            }
        }

        /* Lightbox overlay styles */
        .lightbox-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            display: none;
            justify-content: center;
            align-items: center;
            cursor: zoom-out;
            overflow: hidden;
        }

        .lightbox-overlay.active {
            display: flex;
        }

        .lightbox-container {
            position: relative;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }

        .lightbox-image-wrapper {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            overflow: hidden;
            border-radius: 8px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
            background: white;
        }

        .lightbox-image {
            width: 100%;
            height: auto;
            display: block;
            transition: transform 0.3s ease;
            cursor: grab;
            user-select: none;
            transform-origin: center center;
        }

        .lightbox-image.zoomed {
            cursor: grab;
        }

        .lightbox-image.dragging {
            cursor: grabbing;
        }

        .lightbox-image.no-zoom {
            cursor: default;
        }

        .zoom-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px 15px;
            border-radius: 25px;
            z-index: 1002;
        }

        .zoom-btn {
            background: rgba(255, 255, 255, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            font-weight: bold;
            transition: all 0.2s ease;
        }

        .zoom-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            border-color: rgba(255, 255, 255, 0.5);
        }

        .zoom-indicator {
            color: white;
            font-size: 14px;
            background: rgba(0, 0, 0, 0.5);
            padding: 8px 12px;
            border-radius: 15px;
            min-width: 60px;
            text-align: center;
        }

        .lightbox-close {
            position: absolute;
            top: 20px;
            right: 30px;
            color: white;
            font-size: 40px;
            font-weight: 300;
            cursor: pointer;
            z-index: 1001;
            transition: opacity 0.2s ease;
        }

        .lightbox-close:hover {
            opacity: 0.7;
        }

        .prototype-link {
            display: inline-block;
            background: #1c3664;
            color: white;
            padding: 12px 24px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 500;
            margin-top: 1.5rem;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .prototype-link:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(28, 54, 100, 0.3);
            background: #0f2544;
        }

        .prototype-link.light-blue {
            background: rgba(3, 153, 205, 0.2);
            border: 2px solid rgba(3, 153, 205, 0.3);
            color: #0399cd;
            font-weight: 600;
        }

        .prototype-link.light-blue:hover {
            background: rgba(3, 153, 205, 0.1);
            border-color: rgba(3, 153, 205, 0.5);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(3, 153, 205, 0.2);
        }

        .cta-section {
            background: linear-gradient(135deg, #1c3664 0%, #0399cd 100%);
            color: white;
            text-align: center;
            padding: 60px 0;
        }

        .cta-section h2 {
            color: white;
            margin-bottom: 1rem;
        }

        .cta-section p {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.1rem;
            margin-bottom: 2rem;
        }

        .cta-button {
            background: rgba(255, 255, 255, 0.2);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 15px 30px;
            text-decoration: none;
            border-radius: 8px;
            font-weight: 600;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }

        .cta-button:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.5);
        }

        @media (max-width: 768px) {
            .section-content {
                grid-template-columns: 1fr;
                gap: 40px;
                text-align: center;
            }

            .section:nth-child(even) .section-content {
                direction: ltr;
            }

            .hero-content h1 {
                font-size: 2.5rem;
            }

            .text-content h2 {
                font-size: 1.5rem;
            }

            .section {
                padding: 60px 0;
                min-height: auto;
            }

            .image-content img {
                width: 100%;
                max-width: 500px;
            }
        }

        /* Placeholder image styles */
        .placeholder-img {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            border: 2px dashed #dee2e6;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 200px;
            color: #6c757d;
            font-weight: 500;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <div class="section hero-section">
        <div class="container">
            <div class="hero-content">
                <h1>Redesigning the PenFed Document Upload Experience for Members</h1>
                <p class="subtitle">Transforming a fragmented upload process into a seamless, member-first, transparent experience.</p>
                <p class="author-info">Jennifer Smith | July 2025</p>
            </div>
        </div>
    </div>

    <!-- Challenge Section -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h2>The Challenge</h2>
                    <p>Members typically need to upload documents in two distinct scenarios: when PenFed proactively requests specific documents via email to complete application processing, or when members themselves need to submit forms for their own banking needs. However, both user journeys suffered from the same fundamental issues.</p>
                    <ul>
                        <li>Members encounter scattered entry points across different sections of the site, creating confusion about where to start the upload process</li>
                        <li>The upload experience feels purely transactional—members lack visibility into what happens after submission and receive minimal guidance throughout the process</li>
                        <li>Document status tracking is limited or unclear, leaving members uncertain about whether their submissions were received or approved</li>
                    </ul>
                    <h3>Design Goals:</h3>
                    <ul>
                        <li>Create an upload experience that feels easy, supported, and secure for both proactive and self-service scenarios</li>
                        <li>Surface key documents, requirements, and due dates clearly to reduce member confusion</li>
                        <li>Reinforce trust through transparency, real-time feedback, and clear progress indicators</li>
                    </ul>
                </div>
                <div class="image-content">
                    <img src="PF-HOME.png" alt="Original PenFed Homepage" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Before Section -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h2>Before: The Fragmented Experience</h2>
                    <p>Members faced a scattered, confusing journey when trying to upload documents. Multiple entry points, buried navigation, and unclear pathways created unnecessary friction in what should be a simple, essential task.</p>
                    <p>This disjointed experience often resulted in abandoned uploads, support calls, and delays in processing important financial applications.</p>
                </div>
                <div class="image-content">
                    <div class="thumbnail-grid">
                        
                        <img src="penfed_menu.png" alt="Original PenFed Menu Navigation" onclick="openLightbox(this)">
                        <img src="forms_agreements.png" alt="Forms and Agreements Page" onclick="openLightbox(this)">
                        <img src="secure_upload.png" alt="Secure Upload Interface" onclick="openLightbox(this)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- After - Homepage Entry -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h2>After: A Member-First Flow</h2>
                    <h3>A Unified Destination for All <br>
                    Document Needs</h3>
                    <p>Instead of scattered entry points and guessing games, members now arrive at a single, centralized Document Center—whether prompted by an email or navigating there independently.

The flow supports both proactive and self-guided use cases with equal clarity. Once logged in, members land on a unified dashboard that surfaces key actions, document requirements, and transparent upload status.</p>
                    <a href="https://jenrefins.github.io/penfed-document-center/penfed_document_center.html" class="prototype-link light-blue" target="_blank">View Live Prototype</a>
                </div>
                <div class="image-content">
                    <img src="Doc Center Flow.png" alt="PenFed Document Center Flows" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Document Center -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h3>Personalized Document Center</h3>
                    <p>Members who were contacted via email see a clear action alert at the top, while all users benefit from the intuitive upload entry point and categorized forms. Clicking any form referenced in the toast notification instantly opens the relevant panel below, guiding members to the exact document required.</p>
                </div>
                <div class="image-content">
                    <div class="thumbnail-grid-2">
                        <img src="1_PenFed Document Center - home 1.png" alt="PenFed Document Center Home" onclick="openLightbox(this)">
                        <img src="2_Action_required_toast.png" alt="Action Required Toast Notification" onclick="openLightbox(this)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Upload Modal -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h3>Upload Modal</h3>
                    <p>By pre-filling member details and document requirements, the upload modal eliminates unnecessary form fields and reduces cognitive load. Members can focus on the upload itself rather than navigating complex forms.</p>
                </div>
                <div class="image-content">
                    <img src="3_prefilled_doc_upload_modal.png" alt="Prefilled Document Upload Modal" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Trust Through Transparency -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h2>Emotional Trust Through Transparency</h2>
                    <h3>Success Feedback</h3>
                    <p>Real-time feedback reassures members their documents were received and are being reviewed. Clear status indicators eliminate uncertainty and build confidence.</p>
                </div>
                <div class="image-content">
                    <img src="success_toast_notification.png" alt="Success Toast Notification" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Submission History -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h3>Submission History</h3>
                    <p>Members can view past submissions, check approval statuses, and re-download files if needed. This transparency builds trust and provides members with complete control over their document journey.</p>
                </div>
                <div class="image-content">
                    <img src="1.2submission_history_modal.png" alt="Submission History Modal" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Smart Search -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h2>Smart Search and Required Forms</h2>
                    <h3>Predictive Search</h3>
                    <p>Smart, filtered search helps members find documents effortlessly—typing just two letters triggers the dropdown menu with visual priority cues. Here, entering "Pr" immediately displays matching options like "Proof of Income" and "Proof of Insurance." Selecting any search result automatically opens the relevant expandable panel below, eliminating guesswork and creating a seamless path to the right document.</p>
                </div>
                <div class="image-content">
                    <div class="thumbnail-grid-2">
                        <img src="4_search_dropdown.png" alt="Search Dropdown Interface" onclick="openLightbox(this)">
                        <img src="5_search_highlight_after.png" alt="Search Results with Highlighting" onclick="openLightbox(this)">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Expanded Categories -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h3>Expanded Categories</h3>
                    <p>These comprehensive document categories already existed on PenFed's site, but were buried deep within navigation menus where members struggled to find them. By surfacing this valuable organizational structure directly within the Document Center, members now have immediate access to the browsing experience that was previously hidden away.</p>
                </div>
                <div class="image-content">
                    <img src="forms_documents.png" alt="Forms & Documents" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- Results -->
    <div class="section">
        <div class="container">
            <div class="section-content">
                <div class="text-content">
                    <h2>The Result</h2>
                    <ul>
                        <li><strong>Unified experience</strong> that seamlessly supports both email-prompted uploads and independent document searches</li>
                        <li><strong>Trust through transparency</strong> with real-time feedback loops, submission history, and clear progress indicators</li>
                        <li><strong>Measurable improvement</strong> in user satisfaction—from frustrating treasure hunts to confident, efficient document management</li>
                    </ul>
                </div>
                <div class="image-content">
                    <img src="success_toast_notification.png" alt="Success Toast Notification" onclick="openLightbox(this)">
                </div>
            </div>
        </div>
    </div>

    <!-- CTA Section -->
    <div class="cta-section">
        <div class="container">
            <h2>Thank You</h2>
            <p>Thanks for reviewing this design solution. I'd love to walk you through the full flow live and discuss next steps.</p>
            <a href="https://jenrefins.github.io/penfed-document-center/penfed_document_center.html" class="cta-button" target="_blank">View Interactive Prototype</a>
        </div>
    </div>

    <!-- Lightbox Overlay -->
    <div class="lightbox-overlay" id="lightbox" onclick="closeLightbox(event)">
        <span class="lightbox-close" onclick="closeLightbox()">&times;</span>
        <div class="lightbox-container">
            <div class="lightbox-image-wrapper" id="lightbox-wrapper">
                <img class="lightbox-image" id="lightbox-image" src="" alt="">
            </div>
            <div class="zoom-controls" id="zoom-controls">
                <button class="zoom-btn" onclick="zoomOut(event)">−</button>
                <div class="zoom-indicator" id="zoom-indicator">100%</div>
                <button class="zoom-btn" onclick="zoomIn(event)">+</button>
            </div>
        </div>
    </div>

    <script>
        let currentZoom = 1;
        let isDragging = false;
        let startX, startY, translateX = 0, translateY = 0;
        let currentImageElement = null;

        function openLightbox(element) {
            const lightbox = document.getElementById('lightbox');
            const lightboxImage = document.getElementById('lightbox-image');
            const lightboxWrapper = document.getElementById('lightbox-wrapper');
            const zoomControls = document.getElementById('zoom-controls');
            
            // Reset zoom and position
            currentZoom = 1;
            translateX = 0;
            translateY = 0;
            
            // Handle both img elements and placeholder divs
            if (element.tagName === 'IMG') {
                lightboxImage.src = element.src;
                lightboxImage.alt = element.alt;
                lightboxImage.style.display = 'block';
                currentImageElement = lightboxImage;
                
                // Wait for image to load before setting up drag listeners
                lightboxImage.onload = function() {
                    setupDragListeners();
                    updateImageTransform();
                };
            } else {
                // For placeholder divs, create a placeholder in the lightbox
                lightboxImage.style.display = 'none';
                const placeholder = document.createElement('div');
                placeholder.className = 'placeholder-img';
                placeholder.style.cssText = 'min-height: 300px; width: 100%; font-size: 1.2rem; cursor: grab; user-select: none; display: flex; align-items: center; justify-content: center;';
                placeholder.textContent = element.textContent;
                lightboxWrapper.innerHTML = '';
                lightboxWrapper.appendChild(placeholder);
                currentImageElement = placeholder;
                
                // Set up drag listeners immediately for placeholders
                setupDragListeners();
                updateImageTransform();
            }
            
            // Show zoom controls
            zoomControls.style.display = 'flex';
            
            lightbox.classList.add('active');
            updateZoomIndicator();
            
            // Prevent body scrolling when lightbox is open
            document.body.style.overflow = 'hidden';
        }

        function setupDragListeners() {
            if (!currentImageElement) return;

            // Mouse events
            currentImageElement.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);

            // Touch events for mobile
            currentImageElement.addEventListener('touchstart', startDragTouch, { passive: false });
            document.addEventListener('touchmove', dragTouch, { passive: false });
            document.addEventListener('touchend', endDrag);

            // Prevent context menu
            currentImageElement.addEventListener('contextmenu', e => e.preventDefault());
        }

        function needsPanning() {
            if (!currentImageElement) return false;
            
            const wrapper = document.getElementById('lightbox-wrapper');
            const wrapperRect = wrapper.getBoundingClientRect();
            
            // For images, use natural dimensions
            let imageWidth, imageHeight;
            if (currentImageElement.naturalWidth) {
                imageWidth = currentImageElement.naturalWidth;
                imageHeight = currentImageElement.naturalHeight;
            } else {
                // Fallback for placeholder elements
                const imageRect = currentImageElement.getBoundingClientRect();
                imageWidth = imageRect.width / currentZoom;
                imageHeight = imageRect.height / currentZoom;
            }
            
            // Check if the scaled image is larger than the wrapper
            const scaledWidth = imageWidth * currentZoom;
            const scaledHeight = imageHeight * currentZoom;
            
            return scaledWidth > wrapperRect.width || scaledHeight > wrapperRect.height;
        }

        function startDrag(e) {
            if (!needsPanning()) return;
            e.preventDefault();
            e.stopPropagation(); // Prevent event bubbling
            isDragging = true;
            startX = e.clientX - translateX;
            startY = e.clientY - translateY;
            currentImageElement.classList.add('dragging');
        }

        function startDragTouch(e) {
            if (!needsPanning()) return;
            e.preventDefault();
            e.stopPropagation(); // Prevent event bubbling
            isDragging = true;
            const touch = e.touches[0];
            startX = touch.clientX - translateX;
            startY = touch.clientY - translateY;
            currentImageElement.classList.add('dragging');
        }

        function drag(e) {
            if (!isDragging || !needsPanning()) return;
            e.preventDefault();
            e.stopPropagation(); // Prevent event bubbling
            
            translateX = e.clientX - startX;
            translateY = e.clientY - startY;
            
            // Constrain dragging to image bounds
            constrainPan();
            updateImageTransform();
        }

        function dragTouch(e) {
            if (!isDragging || !needsPanning()) return;
            e.preventDefault();
            e.stopPropagation(); // Prevent event bubbling
            
            const touch = e.touches[0];
            translateX = touch.clientX - startX;
            translateY = touch.clientY - startY;
            
            // Constrain dragging to image bounds
            constrainPan();
            updateImageTransform();
        }

        function endDrag(e) {
            if (isDragging) {
                e.preventDefault();
                e.stopPropagation(); // Prevent event bubbling to lightbox
            }
            isDragging = false;
            if (currentImageElement) {
                currentImageElement.classList.remove('dragging');
            }
        }

        function constrainPan() {
            const wrapper = document.getElementById('lightbox-wrapper');
            const wrapperRect = wrapper.getBoundingClientRect();
            const imageRect = currentImageElement.getBoundingClientRect();
            
            // Get the natural size of the image at current zoom
            const imageNaturalWidth = currentImageElement.naturalWidth || imageRect.width / currentZoom;
            const imageNaturalHeight = currentImageElement.naturalHeight || imageRect.height / currentZoom;
            
            const scaledWidth = imageNaturalWidth * currentZoom;
            const scaledHeight = imageNaturalHeight * currentZoom;
            
            // Calculate how much the image extends beyond the wrapper
            const excessWidth = scaledWidth - wrapperRect.width;
            const excessHeight = scaledHeight - wrapperRect.height;
            
            // Allow panning to see all parts of the image
            if (excessWidth > 0) {
                const maxPanX = excessWidth / 2;
                translateX = Math.min(maxPanX, Math.max(-maxPanX, translateX));
            } else {
                translateX = 0; // Center if image fits horizontally
            }
            
            if (excessHeight > 0) {
                const maxPanY = excessHeight / 2;
                translateY = Math.min(maxPanY, Math.max(-maxPanY, translateY));
            } else {
                translateY = 0; // Center if image fits vertically
            }
        }

        function updateImageTransform() {
            if (currentImageElement) {
                currentImageElement.style.transform = `scale(${currentZoom}) translate(${translateX / currentZoom}px, ${translateY / currentZoom}px)`;
                
                // Update cursor based on whether panning is needed
                if (needsPanning()) {
                    currentImageElement.classList.add('zoomed');
                    currentImageElement.classList.remove('no-zoom');
                } else {
                    currentImageElement.classList.remove('zoomed');
                    currentImageElement.classList.add('no-zoom');
                }
            }
        }

        function zoomIn(e) {
            e.stopPropagation();
            if (currentZoom < 3) {
                currentZoom = Math.min(3, currentZoom + 0.25);
                updateImageTransform();
                updateZoomIndicator();
                
                if (currentZoom > 1) {
                    currentImageElement.classList.add('zoomed');
                }
            }
        }

        function zoomOut(e) {
            e.stopPropagation();
            if (currentZoom > 1) {
                currentZoom = Math.max(1, currentZoom - 0.25);
                
                if (currentZoom === 1) {
                    translateX = 0;
                    translateY = 0;
                    currentImageElement.classList.remove('zoomed');
                }
                
                updateImageTransform();
                updateZoomIndicator();
            }
        }

        function updateZoomIndicator() {
            const indicator = document.getElementById('zoom-indicator');
            indicator.textContent = Math.round(currentZoom * 100) + '%';
        }

        function closeLightbox(e) {
            // Don't close if clicking on zoom controls, dragging, or if event came from drag end
            if (e && (e.target.closest('.zoom-controls') || isDragging || e.target === currentImageElement)) {
                return;
            }
            
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            
            // Reset zoom and position
            currentZoom = 1;
            translateX = 0;
            translateY = 0;
            currentImageElement = null;
            isDragging = false;
            
            // Restore body scrolling
            document.body.style.overflow = 'auto';
        }

        // Mouse wheel zoom
        document.getElementById('lightbox').addEventListener('wheel', function(e) {
            if (!currentImageElement) return;
            
            e.preventDefault();
            const delta = e.deltaY > 0 ? -0.1 : 0.1;
            const newZoom = Math.min(3, Math.max(1, currentZoom + delta));
            
            if (newZoom !== currentZoom) {
                currentZoom = newZoom;
                
                if (currentZoom === 1) {
                    translateX = 0;
                    translateY = 0;
                    currentImageElement.classList.remove('zoomed');
                } else {
                    currentImageElement.classList.add('zoomed');
                }
                
                updateImageTransform();
                updateZoomIndicator();
            }
        });

        // Close lightbox with Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLightbox();
            }
        });

        // Double-click to zoom
        document.getElementById('lightbox').addEventListener('dblclick', function(e) {
            if (!currentImageElement || e.target.closest('.zoom-controls')) return;
            
            if (currentZoom === 1) {
                currentZoom = 2;
                currentImageElement.classList.add('zoomed');
            } else {
                currentZoom = 1;
                translateX = 0;
                translateY = 0;
                currentImageElement.classList.remove('zoomed');
            }
            
            updateImageTransform();
            updateZoomIndicator();
        });
    </script>
</body>
</html>